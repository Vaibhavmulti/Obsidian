- name: Convert Obsidian image embeds (Python)
  run: |
    python3 << 'EOF'
    import re
    from pathlib import Path

    for md in Path(".").rglob("*.md"):
        text = md.read_text(encoding="utf-8")

        def repl(match):
            raw_name = match.group("name")
            size = match.group("size")

            # âœ… Always extract only the filename
            filename = Path(raw_name).name

            base = f'<img src="attachments/{filename}"'

            if size:
                if "x" in size:
                    w, h = size.split("x")
                    return f'{base} width="{w}" height="{h}">'
                else:
                    return f'{base} width="{size}">'
            return f"{base}>"

        new = re.sub(
            r'!\[\[(?P<name>[^|\]]+)(?:\|(?P<size>[0-9x]+))?\]\]',
            repl,
            text
        )

        if new != text:
            md.write_text(new, encoding="utf-8")
    EOF
